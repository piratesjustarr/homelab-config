FROM python:3.12-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    jq \
    && rm -rf /var/lib/apt/lists/*

# Copy yggdrasil-agent code
COPY . .

# Install Python dependencies
RUN pip install --no-cache-dir \
    beeai-framework \
    litellm \
    click \
    pydantic \
    requests \
    python-dotenv

# Create non-root user (use 0 gid for access to root-owned volumes)
RUN useradd -m -u 1000 -g 0 agent

# Ensure beads mount can be written to
RUN mkdir -p /beads && chmod 777 /beads

# Ensure app code is readable by agent
RUN chmod -R a+r /app

USER agent

ENTRYPOINT ["python", "ygg.py"]
CMD ["status"]

